/* --------------------------------------------------------------------------------
  This file was automatically generated by the Athlos Project Editor.
  Athlos Project Editor, v1.0 BETA
-------------------------------------------------------------------------------- */

package com.example.marspioneer.service;
import com.example.marspioneer.model.MPPlayer;
import com.example.marspioneer.persistence.DBManager;
import com.example.marspioneer.proto.DeleteWorldResponse;
import com.nkasenides.athlos.backend.AthlosService;
import com.example.marspioneer.proto.GetPlayerRequest;
import com.example.marspioneer.auth.*;
import com.example.marspioneer.proto.GetPlayerResponse;

public class GetPlayer implements AthlosService<GetPlayerRequest, GetPlayerResponse> {

    @Override    
    public GetPlayerResponse serve(GetPlayerRequest request, Object... additionalParams) {

        System.out.println(request.getGameSessionID());

        //Verify game session:
        final MPPlayer callingPlayer = Auth.verifyGameSessionID(request.getGameSessionID());
        if (callingPlayer == null) {
            return GetPlayerResponse.newBuilder()
                    .setStatus(GetPlayerResponse.Status.NOT_AUTHORIZED)
                    .setMessage("NOT_AUTHORIZED")
                    .build();
        }

        //Retrieve the player:
        final MPPlayer player = DBManager.player.get(request.getPlayerID());
        if (player == null) {
            return GetPlayerResponse.newBuilder()
                    .setStatus(GetPlayerResponse.Status.NO_SUCH_PLAYER)
                    .setMessage("NO_SUCH_PLAYER")
                    .build();
        }

        //Filter out personal info:
        player.setPassword("");

        //Response:
        return GetPlayerResponse.newBuilder()
                .setStatus(GetPlayerResponse.Status.OK)
                .setMessage("OK")
                .setPlayer(player.toProto())
                .build();

    }    
    
}


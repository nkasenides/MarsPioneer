/* --------------------------------------------------------------------------------
  This file was automatically generated by the Athlos Project Editor.
  Athlos Project Editor, v1.0 BETA
-------------------------------------------------------------------------------- */

package com.example.marspioneer.persistence;


import com.nkasenides.athlos.persistence.*;
import com.example.marspioneer.model.*;
import com.raylabz.firestorm.Firestorm;
import com.raylabz.objectis.Objectis;

import java.util.ArrayList;
import java.util.List;
import java.util.Collection;


public class BuildingEntityDAO implements WorldBasedDAO<BuildingEntity> {


    @Override
    public boolean create(BuildingEntity object) {
        Firestorm.create(object);
        Objectis.create(object);
        return true;
    }

    @Override
    public boolean update(BuildingEntity object) {
        Objectis.update(object);
        new Thread(() -> Firestorm.update(object)).start();
        return true;
    }

    @Override
    public boolean delete(BuildingEntity object) {
        Objectis.delete(object);
        new Thread(() -> Firestorm.delete(object)).start();
        return true;
    }

//    @Override
    public BuildingEntity get(String s) {
        return Objectis.get(BuildingEntity.class, s);
    }

    @Override
    public BuildingEntity getForWorld(String worldID, String itemID) {
        final ArrayList<BuildingEntity> items = Objectis.filter(BuildingEntity.class)
                .whereEqualTo("worldID", worldID)
                .whereEqualTo("id", itemID)
                .limit(1)
                .fetch();
        if (items.size() == 0) {
            return null;
        }
        return items.get(0);
    }

    @Override
    public Collection<BuildingEntity> listForWorld(String worldID) {
        return Objectis.filter(BuildingEntity.class)
                .whereEqualTo("worldID", worldID)
                .limit(1)
                .fetch();
    }

/**
     * Retrieves a player's entities within a specific world.
     * @param worldID The world.
     * @param playerID The player.
     * @return Returns a collection of entities.
     */
    public Collection<BuildingEntity> listForPlayerAndWorld(String worldID, String playerID) {
        return Objectis.filter(BuildingEntity.class)
                .whereEqualTo("worldID", worldID)
                .whereEqualTo("playerID", playerID)
                .fetch();
    }
    /**
     * Retrieves a player's entities.
     * @param playerID The player.
     * @return Returns a collection of entities.
     */
    public Collection<BuildingEntity> listForPlayer(String playerID) {
        return Objectis.filter(BuildingEntity.class)
                .whereEqualTo("playerID", playerID)
                .fetch();
    }

    /**
     * Retrieves the entities in a world which are not belonging to a particular player.
     * @param worldID The world ID
     * @param excludedPlayerID The excluded player ID.
     * @return Returns a collection of entities.
     */
    public Collection<BuildingEntity> listForWorldExcludingPlayer(String worldID, String excludedPlayerID) {
        final ArrayList<BuildingEntity> entities = Objectis.filter(BuildingEntity.class)
                .whereEqualTo("worldID", worldID)
                .fetch();

        final ArrayList<BuildingEntity> oEntities = new ArrayList<>();
        for (BuildingEntity entity : entities) {
            if (!entity.getPlayerID().equals(excludedPlayerID)) {
                oEntities.add(entity);
            }
        }
        return oEntities;
    }

}


